(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ed374572"],{"0068":function(t,e,s){},"498a":function(t,e,s){"use strict";var a=s("23e7"),r=s("58a8").trim,n=s("c8d2");a({target:"String",proto:!0,forced:n("trim")},{trim:function(){return r(this)}})},5050:function(t,e,s){"use strict";s("0068")},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,s){var a=s("1d80"),r=s("5899"),n="["+r+"]",o=RegExp("^"+n+n+"*"),i=RegExp(n+n+"*$"),c=function(t){return function(e){var s=String(a(e));return 1&t&&(s=s.replace(o,"")),2&t&&(s=s.replace(i,"")),s}};t.exports={start:c(1),end:c(2),trim:c(3)}},"58d2":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col chat-room-wrapper"},[s("div",{staticClass:"row"},[s("input",{staticClass:"folding-online-user d-none",attrs:{id:"folding-online-user",type:"checkbox"}}),s("div",{staticClass:"col-auto no-gutters center-column p-0 online-user-box"},[s("div",{staticClass:"online-user-title-wrapper title-wrapper px-3 d-flex align-items-center"},[s("h1",{staticClass:"title"},[t._v("上線使用者("+t._s(t.onlineUsers.length||0)+")")])]),s("div",{staticClass:"online-user-list"},t._l(t.onlineUsers,(function(e){return s("div",{key:e.id,staticClass:"user-panel"},[s("div",{staticClass:"d-flex align-items-center connected-user p-2"},[s("img",{staticClass:"user-avatar mr-2",attrs:{src:e.avatar||"https://i.imgur.com/S4PE66O.png",alt:""}}),s("span",[s("router-link",{staticClass:"link-style",attrs:{to:"/users/"+e.id}},[s("strong",{staticClass:"mr-2"},[t._v(t._s(e.name))])]),s("span",{staticClass:"text-gray"},[t._v("@"+t._s(e.account))])],1)])])})),0)]),s("div",{staticClass:"col right-column no-gutters p-0",attrs:{id:"main-panel"}},[t._m(0),s("div",{staticClass:"message-board",attrs:{id:"message-board"},on:{scroll:t.isToBelow}},[t._l(t.messages,(function(e){return s("div",{key:e.id,staticClass:"message-box"},[void 0===e.stasus&&e.UserId===t.currentUser.id?s("div",{staticClass:"my-message-wrapper d-flex justify-content-end px-3 py-1"},[s("div",{staticClass:"message"},[s("div",{staticClass:"d-flex justify-content-end"},[s("div",{staticClass:"message-text my-message-text py-2 px-3"},[t._v(" "+t._s(e.message)+" ")])]),s("div",{staticClass:"message-time text-right text-gray"},[t._v(" "+t._s(new Date(e.time).toLocaleString())+" ")])])]):t._e(),void 0===e.stasus&&e.UserId!==t.currentUser.id?s("div",{staticClass:"message-wrapper d-flex align-items-end px-3 py-2"},[s("img",{staticClass:"message-avatar mr-2",attrs:{src:e.avatar||"https://i.imgur.com/S4PE66O.png",alt:""}}),s("div",{staticClass:"message flex-grow-1"},[s("div",{staticClass:"message-text bg-gray py-2 px-3"},[t._v(" "+t._s(e.message)+" ")]),s("div",{staticClass:"message-time text-gray"},[t._v(" "+t._s(e.name)+" said at "+t._s(new Date(e.time).toLocaleString())+" ")])])]):t._e(),"on"===e.stasus&&e.userId!==t.currentUser.id?s("div",{staticClass:"user-status-wrapper d-flex justify-content-center py-2"},[s("div",{staticClass:"user-status badge badge-pill bg-gray font-weight-bold text-gray px-3"},[t._v(" "+t._s(e.userName)+" 上線 ")])]):t._e(),"off"===e.stasus&&e.userId!==t.currentUser.id?s("div",{staticClass:"user-status-wrapper d-flex justify-content-center py-2"},[s("div",{staticClass:"user-status badge badge-pill bg-gray font-weight-bold text-gray px-3"},[t._v(" "+t._s(e.userName)+" 下線 ")])]):t._e()])})),s("button",{directives:[{name:"show",rawName:"v-show",value:!t.scrollToBottom,expression:"!scrollToBottom"}],staticClass:"to-bot-btn btn",on:{click:function(e){t.scrollToBottom=!0}}},[s("i",{staticClass:"fas fa-arrow-down"})])],2),s("form",{staticClass:"message-form",attrs:{action:""},on:{submit:function(t){t.stopPropagation(),t.preventDefault()}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newMessage,expression:"newMessage"}],staticClass:"message-input flex-grow-1 border-0 rounded-pill bg-gray form-control",attrs:{type:"text",name:"message",placeholder:"輸入訊息...",autocomplete:"off"},domProps:{value:t.newMessage},on:{input:function(e){e.target.composing||(t.newMessage=e.target.value)}}}),s("button",{staticClass:"btn send-message-btn",on:{click:t.sendMessage,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage(e)}}},[s("i",{staticClass:"fas fa-location-arrow"})])])])])])},r=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"title-wrapper px-3 d-flex align-items-center"},[s("h1",{staticClass:"title"},[t._v("公開聊天室")]),s("label",{attrs:{for:"folding-online-user"}},[s("i",{staticClass:"fas fa-list-ul"})])])}],n=(s("b0c0"),s("498a"),s("96cf"),s("1da1")),o=s("5530"),i=s("2f62"),c=s("84e8"),u=s("2fa3"),l=s("ec26"),d={components:{},data:function(){return{onlineUsers:[],messages:[],newMessage:"",scrollModel:"",scrollPosition:0,scrollToBottom:!0}},created:function(){this.fetchPublicChatRoomHistory()},mounted:function(){this.fetchOnlineUsers(),this.scrollModel=document.getElementById("message-board")},updated:function(){!0===this.scrollToBottom&&(this.scrollModel.scrollTop=this.scrollModel.scrollHeight)},destroyed:function(){this.$store.commit("leavePublicChatRoom")},computed:Object(o["a"])({},Object(i["b"])(["currentUser","isInPublicChatRoom"])),sockets:{"init-public":function(t){this.onlineUsers=t},"public-message":function(t){t.id=Object(l["a"])(),t.UserId=t.userId,this.messages.push(t),this.$socket.emit("message-read-timestamp",{channelId:0,time:Date.now()})},"user-on-off-line":function(t){if(t.id!==this.currentUser.id){var e={stasus:t.status,userId:t.id,id:Object(l["a"])(),userName:t.name},s={status:t.status,account:t.account,avatar:t.avatar,id:t.id,name:t.name};this.messages.push(e),"on"===s.status&&this.onlineUsers.push(s)}}},methods:{fetchOnlineUsers:function(){this.$socket.emit("init-public",Date.now())},fetchPublicChatRoomHistory:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].getPublicChatRoomHistory({userId:t.currentUser.id});case 3:if(s=e.sent,200===s.status){e.next=6;break}throw new Error(s.statusText);case 6:t.messages=s.data,t.$socket.emit("message-read-timestamp",{channelId:0,time:Date.now()}),t.$store.commit("enterPublicChatRoom"),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),console.log(e.t0),u["a"].fire({icon:"error",title:"無法取得上線使用者資訊，請稍後再試"});case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()},sendMessage:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.newMessage.trim().length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.$socket.emit("public-message",{account:t.currentUser.account,avatar:t.currentUser.avatar,UserId:t.currentUser.id,name:t.currentUser.name,message:t.newMessage,time:Date.now()});case 4:t.newMessage="",t.scrollToBottom=!0;case 6:case"end":return e.stop()}}),e)})))()},isToBelow:function(){this.scrollPosition=this.scrollModel.scrollTop+this.scrollModel.clientHeight,this.scrollPosition<this.scrollModel.scrollHeight?this.scrollToBottom=!1:this.scrollToBottom=!0}}},m=d,g=(s("5050"),s("2877")),f=Object(g["a"])(m,a,r,!1,null,"207c4454",null);e["default"]=f.exports},"84e8":function(t,e,s){"use strict";var a=s("2fa3"),r=function(){return localStorage.getItem("token")};e["a"]={getPublicChatRoomHistory:function(t){var e=t.userId;return a["b"].post("/chat/messages",{channelId:0,userId:e},{headers:{Authorization:"Bearer ".concat(r())}})},getPublicChatRoomUnread:function(t){var e=t.userId;return a["b"].post("/chat/public_unread",{userId:e},{headers:{Authorization:"Bearer ".concat(r())}})},getAllPrivateChatRooms:function(){return a["b"].get("/chat/all_private_rooms",{headers:{Authorization:"Bearer ".concat(r())}})},getPrivateChatRoomHistory:function(t){var e=t.channelId,s=t.userId;return a["b"].post("/chat/messages",{channelId:e,userId:s},{headers:{Authorization:"Bearer ".concat(r())}})},getPrivateChatRoomUnread:function(){return a["b"].get("/chat/private_unread",{headers:{Authorization:"Bearer ".concat(r())}})},getAllUsers:function(){return a["b"].get("/users?accumulatedNum=all",{headers:{Authorization:"Bearer ".concat(r())}})}}},c8d2:function(t,e,s){var a=s("d039"),r=s("5899"),n="​᠎";t.exports=function(t){return a((function(){return!!r[t]()||n[t]()!=n||r[t].name!==t}))}},ec26:function(t,e,s){"use strict";var a,r=new Uint8Array(16);function n(){if(!a&&(a="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!a))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(r)}var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function i(t){return"string"===typeof t&&o.test(t)}for(var c=i,u=[],l=0;l<256;++l)u.push((l+256).toString(16).substr(1));function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]).toLowerCase();if(!c(s))throw TypeError("Stringified UUID is invalid");return s}var m=d;function g(t,e,s){t=t||{};var a=t.random||(t.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){s=s||0;for(var r=0;r<16;++r)e[s+r]=a[r];return e}return m(a)}e["a"]=g}}]);
//# sourceMappingURL=chunk-ed374572.773c2f4e.js.map