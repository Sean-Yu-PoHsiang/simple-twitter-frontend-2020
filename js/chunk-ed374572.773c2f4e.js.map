{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es.string.trim.js","webpack:///./src/views/PublicChatroom.vue?54ee","webpack:///./node_modules/core-js/internals/whitespaces.js","webpack:///./node_modules/core-js/internals/string-trim.js","webpack:///./src/views/PublicChatroom.vue?f876","webpack:///src/views/PublicChatroom.vue","webpack:///./src/views/PublicChatroom.vue?a4d0","webpack:///./src/views/PublicChatroom.vue","webpack:///./src/apis/chatRoom.js","webpack:///./node_modules/core-js/internals/string-trim-forced.js","webpack:///./node_modules/uuid/dist/esm-browser/rng.js","webpack:///./node_modules/uuid/dist/esm-browser/regex.js","webpack:///./node_modules/uuid/dist/esm-browser/validate.js","webpack:///./node_modules/uuid/dist/esm-browser/stringify.js","webpack:///./node_modules/uuid/dist/esm-browser/v4.js"],"names":["$","$trim","trim","forcedStringTrimMethod","target","proto","forced","this","module","exports","requireObjectCoercible","whitespaces","whitespace","ltrim","RegExp","rtrim","createMethod","TYPE","$this","string","String","replace","start","end","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","_v","_s","onlineUsers","length","_l","onlineUser","key","id","avatar","name","account","_m","on","isToBelow","message","undefined","stasus","UserId","currentUser","Date","time","toLocaleString","_e","userId","userName","directives","rawName","value","scrollToBottom","expression","$event","stopPropagation","preventDefault","domProps","composing","newMessage","sendMessage","type","indexOf","_k","keyCode","staticRenderFns","components","data","messages","scrollModel","scrollPosition","created","fetchPublicChatRoomHistory","mounted","fetchOnlineUsers","document","getElementById","updated","scrollTop","scrollHeight","destroyed","$store","commit","computed","sockets","push","$socket","emit","userOnOff","status","userStasus","nowOnlineUser","methods","now","clientHeight","component","getToken","localStorage","getItem","getPublicChatRoomHistory","apiHelper","post","channelId","headers","Authorization","getPublicChatRoomUnread","getAllPrivateChatRooms","get","getPrivateChatRoomHistory","getPrivateChatRoomUnread","getAllUsers","fails","non","METHOD_NAME","getRandomValues","rnds8","Uint8Array","rng","crypto","bind","msCrypto","Error","validate","uuid","test","byteToHex","toString","substr","stringify","arr","offset","arguments","toLowerCase","TypeError","v4","options","buf","rnds","random","i"],"mappings":"2IACA,IAAIA,EAAI,EAAQ,QACZC,EAAQ,EAAQ,QAA4BC,KAC5CC,EAAyB,EAAQ,QAIrCH,EAAE,CAAEI,OAAQ,SAAUC,OAAO,EAAMC,OAAQH,EAAuB,SAAW,CAC3ED,KAAM,WACJ,OAAOD,EAAMM,U,kCCTjB,W,mBCEAC,EAAOC,QAAU,iD,uBCFjB,IAAIC,EAAyB,EAAQ,QACjCC,EAAc,EAAQ,QAEtBC,EAAa,IAAMD,EAAc,IACjCE,EAAQC,OAAO,IAAMF,EAAaA,EAAa,KAC/CG,EAAQD,OAAOF,EAAaA,EAAa,MAGzCI,EAAe,SAAUC,GAC3B,OAAO,SAAUC,GACf,IAAIC,EAASC,OAAOV,EAAuBQ,IAG3C,OAFW,EAAPD,IAAUE,EAASA,EAAOE,QAAQR,EAAO,KAClC,EAAPI,IAAUE,EAASA,EAAOE,QAAQN,EAAO,KACtCI,IAIXX,EAAOC,QAAU,CAGfa,MAAON,EAAa,GAGpBO,IAAKP,EAAa,GAGlBd,KAAMc,EAAa,K,2CC1BrB,IAAIQ,EAAS,WAAa,IAAIC,EAAIlB,KAASmB,EAAGD,EAAIE,eAAmBC,EAAGH,EAAII,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,yBAAyB,CAACF,EAAG,MAAM,CAACE,YAAY,OAAO,CAACF,EAAG,QAAQ,CAACE,YAAY,6BAA6BC,MAAM,CAAC,GAAK,sBAAsB,KAAO,cAAcH,EAAG,MAAM,CAACE,YAAY,yDAAyD,CAACF,EAAG,MAAM,CAACE,YAAY,0EAA0E,CAACF,EAAG,KAAK,CAACE,YAAY,SAAS,CAACL,EAAIO,GAAG,SAASP,EAAIQ,GAAGR,EAAIS,YAAYC,QAAU,GAAG,SAASP,EAAG,MAAM,CAACE,YAAY,oBAAoBL,EAAIW,GAAIX,EAAe,aAAE,SAASY,GAAY,OAAOT,EAAG,MAAM,CAACU,IAAID,EAAWE,GAAGT,YAAY,cAAc,CAACF,EAAG,MAAM,CAACE,YAAY,gDAAgD,CAACF,EAAG,MAAM,CAACE,YAAY,mBAAmBC,MAAM,CAAC,IAAMM,EAAWG,QAAU,kCAAkC,IAAM,MAAMZ,EAAG,OAAO,CAACA,EAAG,cAAc,CAACE,YAAY,aAAaC,MAAM,CAAC,GAAK,UAAYM,EAAWE,KAAK,CAACX,EAAG,SAAS,CAACE,YAAY,QAAQ,CAACL,EAAIO,GAAGP,EAAIQ,GAAGI,EAAWI,WAAWb,EAAG,OAAO,CAACE,YAAY,aAAa,CAACL,EAAIO,GAAG,IAAIP,EAAIQ,GAAGI,EAAWK,aAAa,UAAS,KAAKd,EAAG,MAAM,CAACE,YAAY,kCAAkCC,MAAM,CAAC,GAAK,eAAe,CAACN,EAAIkB,GAAG,GAAGf,EAAG,MAAM,CAACE,YAAY,gBAAgBC,MAAM,CAAC,GAAK,iBAAiBa,GAAG,CAAC,OAASnB,EAAIoB,YAAY,CAACpB,EAAIW,GAAIX,EAAY,UAAE,SAASqB,GAAS,OAAOlB,EAAG,MAAM,CAACU,IAAIQ,EAAQP,GAAGT,YAAY,eAAe,MACh4CiB,IAAnBD,EAAQE,QACRF,EAAQG,SAAWxB,EAAIyB,YAAYX,GACnCX,EAAG,MAAM,CAACE,YAAY,2DAA2D,CAACF,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,MAAM,CAACE,YAAY,8BAA8B,CAACF,EAAG,MAAM,CAACE,YAAY,0CAA0C,CAACL,EAAIO,GAAG,IAAIP,EAAIQ,GAAGa,EAAQA,SAAS,SAASlB,EAAG,MAAM,CAACE,YAAY,qCAAqC,CAACL,EAAIO,GAAG,IAAIP,EAAIQ,GAAG,IAAIkB,KAAKL,EAAQM,MAAMC,kBAAkB,WAAW5B,EAAI6B,UACzYP,IAAnBD,EAAQE,QACRF,EAAQG,SAAWxB,EAAIyB,YAAYX,GACnCX,EAAG,MAAM,CAACE,YAAY,oDAAoD,CAACF,EAAG,MAAM,CAACE,YAAY,sBAAsBC,MAAM,CAAC,IAAMe,EAAQN,QAAU,kCAAkC,IAAM,MAAMZ,EAAG,MAAM,CAACE,YAAY,uBAAuB,CAACF,EAAG,MAAM,CAACE,YAAY,kCAAkC,CAACL,EAAIO,GAAG,IAAIP,EAAIQ,GAAGa,EAAQA,SAAS,OAAOlB,EAAG,MAAM,CAACE,YAAY,0BAA0B,CAACL,EAAIO,GAAG,IAAIP,EAAIQ,GAAGa,EAAQL,MAAM,YAAYhB,EAAIQ,GAAG,IAAIkB,KAAKL,EAAQM,MAAMC,kBAAkB,WAAW5B,EAAI6B,KAC9d,OAAnBR,EAAQE,QAAmBF,EAAQS,SAAW9B,EAAIyB,YAAYX,GAC9DX,EAAG,MAAM,CAACE,YAAY,0DAA0D,CAACF,EAAG,MAAM,CAACE,YAAY,wEAAwE,CAACL,EAAIO,GAAG,IAAIP,EAAIQ,GAAGa,EAAQU,UAAU,YAAY/B,EAAI6B,KACjN,QAAnBR,EAAQE,QAAoBF,EAAQS,SAAW9B,EAAIyB,YAAYX,GAC/DX,EAAG,MAAM,CAACE,YAAY,0DAA0D,CAACF,EAAG,MAAM,CAACE,YAAY,wEAAwE,CAACL,EAAIO,GAAG,IAAIP,EAAIQ,GAAGa,EAAQU,UAAU,YAAY/B,EAAI6B,UAAS1B,EAAG,SAAS,CAAC6B,WAAW,CAAC,CAAChB,KAAK,OAAOiB,QAAQ,SAASC,OAAQlC,EAAImC,eAAgBC,WAAW,oBAAoB/B,YAAY,iBAAiBc,GAAG,CAAC,MAAQ,SAASkB,GAAQrC,EAAImC,gBAAiB,KAAQ,CAAChC,EAAG,IAAI,CAACE,YAAY,yBAAyB,GAAGF,EAAG,OAAO,CAACE,YAAY,eAAeC,MAAM,CAAC,OAAS,IAAIa,GAAG,CAAC,OAAS,SAASkB,GAAQA,EAAOC,kBAAkBD,EAAOE,oBAAqB,CAACpC,EAAG,QAAQ,CAAC6B,WAAW,CAAC,CAAChB,KAAK,QAAQiB,QAAQ,UAAUC,MAAOlC,EAAc,WAAEoC,WAAW,eAAe/B,YAAY,uEAAuEC,MAAM,CAAC,KAAO,OAAO,KAAO,UAAU,YAAc,UAAU,aAAe,OAAOkC,SAAS,CAAC,MAASxC,EAAc,YAAGmB,GAAG,CAAC,MAAQ,SAASkB,GAAWA,EAAO1D,OAAO8D,YAAqBzC,EAAI0C,WAAWL,EAAO1D,OAAOuD,WAAU/B,EAAG,SAAS,CAACE,YAAY,uBAAuBc,GAAG,CAAC,MAAQnB,EAAI2C,YAAY,MAAQ,SAASN,GAAQ,OAAIA,EAAOO,KAAKC,QAAQ,QAAQ7C,EAAI8C,GAAGT,EAAOU,QAAQ,QAAQ,GAAGV,EAAOxB,IAAI,SAAkB,KAAcb,EAAI2C,YAAYN,MAAW,CAAClC,EAAG,IAAI,CAACE,YAAY,qCAC9xC2C,EAAkB,CAAC,WAAa,IAAIhD,EAAIlB,KAASmB,EAAGD,EAAIE,eAAmBC,EAAGH,EAAII,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,gDAAgD,CAACF,EAAG,KAAK,CAACE,YAAY,SAAS,CAACL,EAAIO,GAAG,WAAWJ,EAAG,QAAQ,CAACG,MAAM,CAAC,IAAM,wBAAwB,CAACH,EAAG,IAAI,CAACE,YAAY,yB,wGCiJxS,GACE4C,WAAY,GACZC,KAFF,WAGI,MAAO,CACLzC,YAAa,GACb0C,SAAU,GACVT,WAAY,GACZU,YAAa,GACbC,eAAgB,EAChBlB,gBAAgB,IAGpBmB,QAZF,WAaIxE,KAAKyE,8BAEPC,QAfF,WAgBI1E,KAAK2E,mBACL3E,KAAKsE,YAAcM,SAASC,eAAe,kBAE7CC,QAnBF,YAoBgC,IAAxB9E,KAAKqD,iBACPrD,KAAKsE,YAAYS,UAAY/E,KAAKsE,YAAYU,eAGlDC,UAxBF,WAyBIjF,KAAKkF,OAAOC,OAAO,wBAErBC,SAAU,OAAZ,OAAY,CAAZ,GACA,sDAEEC,QAAS,CACP,cAAe,SAAnB,GACMrF,KAAK2B,YAAcA,GAErB,iBAAkB,SAAtB,GACMY,EAAQP,GAAK,OAAnB,OAAmB,GACbO,EAAQG,OAASH,EAAQS,OACzBhD,KAAKqE,SAASiB,KAAK/C,GACnBvC,KAAKuF,QAAQC,KAAK,yBAA0B,CAAlD,+BAEI,mBAAoB,SAAxB,GACM,GAAIC,EAAUzD,KAAOhC,KAAK2C,YAAYX,GAAtC,CAIA,IAAN,GACQS,OAAQgD,EAAUC,OAClB1C,OAAQyC,EAAUzD,GAClBA,GAAI,OAAZ,OAAY,GACJiB,SAAUwC,EAAUvD,MAE5B,GACQwD,OAAQD,EAAUC,OAClBvD,QAASsD,EAAUtD,QACnBF,OAAQwD,EAAUxD,OAClBD,GAAIyD,EAAUzD,GACdE,KAAMuD,EAAUvD,MAElBlC,KAAKqE,SAASiB,KAAKK,GACU,OAAzBC,EAAcF,QAChB1F,KAAK2B,YAAY2D,KAAKM,MAI5BC,QAAS,CACPlB,iBADJ,WAEM3E,KAAKuF,QAAQC,KAAK,cAAe5C,KAAKkD,QAExC,2BAJJ,WAIA,uLAEA,2DAFA,UAEA,EAFA,OAIA,eAJA,sBAKA,wBALA,OAQA,kBACA,uEACA,uCAVA,qDAaA,kBACA,aACA,aACA,4BAhBA,6DAoBI,YAxBJ,WAwBA,2JACA,+BADA,iEAEA,iCACA,8BACA,4BACA,wBACA,wBACA,qBACA,kBARA,OAUA,gBACA,oBAXA,8CAaIxD,UArCJ,WAsCMtC,KAAKuE,eAAiBvE,KAAKsE,YAAYS,UAAY/E,KAAKsE,YAAYyB,aAChE/F,KAAKuE,eAAiBvE,KAAKsE,YAAYU,aACzChF,KAAKqD,gBAAiB,EAEtBrD,KAAKqD,gBAAiB,KCtQ0T,I,wBCQpV2C,EAAY,eACd,EACA/E,EACAiD,GACA,EACA,KACA,WACA,MAIa,aAAA8B,E,6CCnBf,gBACMC,EAAW,kBAAMC,aAAaC,QAAQ,UAE7B,QACbC,yBADa,YACwB,IAAVpD,EAAU,EAAVA,OACzB,OAAOqD,OAAUC,KAAK,iBAAkB,CACtCC,UAAW,EACXvD,UACC,CACDwD,QAAS,CAAEC,cAAe,UAAF,OAAYR,SAGxCS,wBATa,YASuB,IAAV1D,EAAU,EAAVA,OACxB,OAAOqD,OAAUC,KAAK,sBAAuB,CAC3CtD,UACC,CACDwD,QAAS,CAAEC,cAAe,UAAF,OAAYR,SAGxCU,uBAhBa,WAiBX,OAAON,OAAUO,IAAI,0BAA2B,CAC9CJ,QAAS,CAAEC,cAAe,UAAF,OAAYR,SAGxCY,0BArBa,YAqBoC,IAArBN,EAAqB,EAArBA,UAAWvD,EAAU,EAAVA,OACrC,OAAOqD,OAAUC,KAAK,iBAAkB,CACtCC,YACAvD,UACC,CACDwD,QAAS,CAAEC,cAAe,UAAF,OAAYR,SAGxCa,yBA7Ba,WA8BX,OAAOT,OAAUO,IAAI,uBAAwB,CAC3CJ,QAAS,CAAEC,cAAe,UAAF,OAAYR,SAGxCc,YAlCa,WAmCX,OAAOV,OAAUO,IAAV,4BAA2C,CAChDJ,QAAS,CAAEC,cAAe,UAAF,OAAYR,W,qBCvC1C,IAAIe,EAAQ,EAAQ,QAChB5G,EAAc,EAAQ,QAEtB6G,EAAM,MAIVhH,EAAOC,QAAU,SAAUgH,GACzB,OAAOF,GAAM,WACX,QAAS5G,EAAY8G,MAAkBD,EAAIC,MAAkBD,GAAO7G,EAAY8G,GAAahF,OAASgF,O,kCCN1G,IAAIC,EACAC,EAAQ,IAAIC,WAAW,IACZ,SAASC,IAEtB,IAAKH,IAGHA,EAAoC,qBAAXI,QAA0BA,OAAOJ,iBAAmBI,OAAOJ,gBAAgBK,KAAKD,SAA+B,qBAAbE,UAAgE,oBAA7BA,SAASN,iBAAkCM,SAASN,gBAAgBK,KAAKC,WAElON,GACH,MAAM,IAAIO,MAAM,4GAIpB,OAAOP,EAAgBC,GCjBV,4HCEf,SAASO,EAASC,GAChB,MAAuB,kBAATA,GAAqB,EAAMC,KAAKD,GCKhD,IDFe,QCAXE,EAAY,GAEP,EAAI,EAAG,EAAI,MAAO,EACzBA,EAAUxC,MAAM,EAAI,KAAOyC,SAAS,IAAIC,OAAO,IAGjD,SAASC,EAAUC,GACjB,IAAIC,EAASC,UAAUxG,OAAS,QAAsBY,IAAjB4F,UAAU,GAAmBA,UAAU,GAAK,EAG7ER,GAAQE,EAAUI,EAAIC,EAAS,IAAML,EAAUI,EAAIC,EAAS,IAAML,EAAUI,EAAIC,EAAS,IAAML,EAAUI,EAAIC,EAAS,IAAM,IAAML,EAAUI,EAAIC,EAAS,IAAML,EAAUI,EAAIC,EAAS,IAAM,IAAML,EAAUI,EAAIC,EAAS,IAAML,EAAUI,EAAIC,EAAS,IAAM,IAAML,EAAUI,EAAIC,EAAS,IAAML,EAAUI,EAAIC,EAAS,IAAM,IAAML,EAAUI,EAAIC,EAAS,KAAOL,EAAUI,EAAIC,EAAS,KAAOL,EAAUI,EAAIC,EAAS,KAAOL,EAAUI,EAAIC,EAAS,KAAOL,EAAUI,EAAIC,EAAS,KAAOL,EAAUI,EAAIC,EAAS,MAAME,cAMzf,IAAK,EAAST,GACZ,MAAMU,UAAU,+BAGlB,OAAOV,EAGM,QC1Bf,SAASW,EAAGC,EAASC,EAAKN,GACxBK,EAAUA,GAAW,GACrB,IAAIE,EAAOF,EAAQG,SAAWH,EAAQlB,KAAOA,KAK7C,GAHAoB,EAAK,GAAe,GAAVA,EAAK,GAAY,GAC3BA,EAAK,GAAe,GAAVA,EAAK,GAAY,IAEvBD,EAAK,CACPN,EAASA,GAAU,EAEnB,IAAK,IAAIS,EAAI,EAAGA,EAAI,KAAMA,EACxBH,EAAIN,EAASS,GAAKF,EAAKE,GAGzB,OAAOH,EAGT,OAAO,EAAUC,GAGJ","file":"js/chunk-ed374572.773c2f4e.js","sourcesContent":["'use strict';\nvar $ = require('../internals/export');\nvar $trim = require('../internals/string-trim').trim;\nvar forcedStringTrimMethod = require('../internals/string-trim-forced');\n\n// `String.prototype.trim` method\n// https://tc39.github.io/ecma262/#sec-string.prototype.trim\n$({ target: 'String', proto: true, forced: forcedStringTrimMethod('trim') }, {\n  trim: function trim() {\n    return $trim(this);\n  }\n});\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicChatroom.vue?vue&type=style&index=0&id=207c4454&scoped=true&lang=css&\"","// a string of all valid unicode whitespaces\n// eslint-disable-next-line max-len\nmodule.exports = '\\u0009\\u000A\\u000B\\u000C\\u000D\\u0020\\u00A0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF';\n","var requireObjectCoercible = require('../internals/require-object-coercible');\nvar whitespaces = require('../internals/whitespaces');\n\nvar whitespace = '[' + whitespaces + ']';\nvar ltrim = RegExp('^' + whitespace + whitespace + '*');\nvar rtrim = RegExp(whitespace + whitespace + '*$');\n\n// `String.prototype.{ trim, trimStart, trimEnd, trimLeft, trimRight }` methods implementation\nvar createMethod = function (TYPE) {\n  return function ($this) {\n    var string = String(requireObjectCoercible($this));\n    if (TYPE & 1) string = string.replace(ltrim, '');\n    if (TYPE & 2) string = string.replace(rtrim, '');\n    return string;\n  };\n};\n\nmodule.exports = {\n  // `String.prototype.{ trimLeft, trimStart }` methods\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trimstart\n  start: createMethod(1),\n  // `String.prototype.{ trimRight, trimEnd }` methods\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trimend\n  end: createMethod(2),\n  // `String.prototype.trim` method\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trim\n  trim: createMethod(3)\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"col chat-room-wrapper\"},[_c('div',{staticClass:\"row\"},[_c('input',{staticClass:\"folding-online-user d-none\",attrs:{\"id\":\"folding-online-user\",\"type\":\"checkbox\"}}),_c('div',{staticClass:\"col-auto no-gutters center-column p-0 online-user-box\"},[_c('div',{staticClass:\"online-user-title-wrapper title-wrapper px-3 d-flex align-items-center\"},[_c('h1',{staticClass:\"title\"},[_vm._v(\"上線使用者(\"+_vm._s(_vm.onlineUsers.length || 0)+\")\")])]),_c('div',{staticClass:\"online-user-list\"},_vm._l((_vm.onlineUsers),function(onlineUser){return _c('div',{key:onlineUser.id,staticClass:\"user-panel\"},[_c('div',{staticClass:\"d-flex align-items-center connected-user p-2\"},[_c('img',{staticClass:\"user-avatar mr-2\",attrs:{\"src\":onlineUser.avatar || 'https://i.imgur.com/S4PE66O.png',\"alt\":\"\"}}),_c('span',[_c('router-link',{staticClass:\"link-style\",attrs:{\"to\":'/users/' + onlineUser.id}},[_c('strong',{staticClass:\"mr-2\"},[_vm._v(_vm._s(onlineUser.name))])]),_c('span',{staticClass:\"text-gray\"},[_vm._v(\"@\"+_vm._s(onlineUser.account))])],1)])])}),0)]),_c('div',{staticClass:\"col right-column no-gutters p-0\",attrs:{\"id\":\"main-panel\"}},[_vm._m(0),_c('div',{staticClass:\"message-board\",attrs:{\"id\":\"message-board\"},on:{\"scroll\":_vm.isToBelow}},[_vm._l((_vm.messages),function(message){return _c('div',{key:message.id,staticClass:\"message-box\"},[(\n              message.stasus === undefined &&\n              message.UserId === _vm.currentUser.id\n            )?_c('div',{staticClass:\"my-message-wrapper d-flex justify-content-end px-3 py-1\"},[_c('div',{staticClass:\"message\"},[_c('div',{staticClass:\"d-flex justify-content-end\"},[_c('div',{staticClass:\"message-text my-message-text py-2 px-3\"},[_vm._v(\" \"+_vm._s(message.message)+\" \")])]),_c('div',{staticClass:\"message-time text-right text-gray\"},[_vm._v(\" \"+_vm._s(new Date(message.time).toLocaleString())+\" \")])])]):_vm._e(),(\n              message.stasus === undefined &&\n              message.UserId !== _vm.currentUser.id\n            )?_c('div',{staticClass:\"message-wrapper d-flex align-items-end px-3 py-2\"},[_c('img',{staticClass:\"message-avatar mr-2\",attrs:{\"src\":message.avatar || 'https://i.imgur.com/S4PE66O.png',\"alt\":\"\"}}),_c('div',{staticClass:\"message flex-grow-1\"},[_c('div',{staticClass:\"message-text bg-gray py-2 px-3\"},[_vm._v(\" \"+_vm._s(message.message)+\" \")]),_c('div',{staticClass:\"message-time text-gray\"},[_vm._v(\" \"+_vm._s(message.name)+\" said at \"+_vm._s(new Date(message.time).toLocaleString())+\" \")])])]):_vm._e(),(\n              message.stasus === 'on' && message.userId !== _vm.currentUser.id\n            )?_c('div',{staticClass:\"user-status-wrapper d-flex justify-content-center py-2\"},[_c('div',{staticClass:\"user-status badge badge-pill bg-gray font-weight-bold text-gray px-3\"},[_vm._v(\" \"+_vm._s(message.userName)+\" 上線 \")])]):_vm._e(),(\n              message.stasus === 'off' && message.userId !== _vm.currentUser.id\n            )?_c('div',{staticClass:\"user-status-wrapper d-flex justify-content-center py-2\"},[_c('div',{staticClass:\"user-status badge badge-pill bg-gray font-weight-bold text-gray px-3\"},[_vm._v(\" \"+_vm._s(message.userName)+\" 下線 \")])]):_vm._e()])}),_c('button',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.scrollToBottom),expression:\"!scrollToBottom\"}],staticClass:\"to-bot-btn btn\",on:{\"click\":function($event){_vm.scrollToBottom = true}}},[_c('i',{staticClass:\"fas fa-arrow-down\"})])],2),_c('form',{staticClass:\"message-form\",attrs:{\"action\":\"\"},on:{\"submit\":function($event){$event.stopPropagation();$event.preventDefault();}}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.newMessage),expression:\"newMessage\"}],staticClass:\"message-input flex-grow-1 border-0 rounded-pill bg-gray form-control\",attrs:{\"type\":\"text\",\"name\":\"message\",\"placeholder\":\"輸入訊息...\",\"autocomplete\":\"off\"},domProps:{\"value\":(_vm.newMessage)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.newMessage=$event.target.value}}}),_c('button',{staticClass:\"btn send-message-btn\",on:{\"click\":_vm.sendMessage,\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.sendMessage($event)}}},[_c('i',{staticClass:\"fas fa-location-arrow\"})])])])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"title-wrapper px-3 d-flex align-items-center\"},[_c('h1',{staticClass:\"title\"},[_vm._v(\"公開聊天室\")]),_c('label',{attrs:{\"for\":\"folding-online-user\"}},[_c('i',{staticClass:\"fas fa-list-ul\"})])])}]\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"col chat-room-wrapper\">\n    <div class=\"row\">\n      <input\n        class=\"folding-online-user d-none\"\n        id=\"folding-online-user\"\n        type=\"checkbox\"\n      />\n      <div class=\"col-auto no-gutters center-column p-0 online-user-box\">\n        <div\n          class=\"online-user-title-wrapper title-wrapper px-3 d-flex align-items-center\"\n        >\n          <h1 class=\"title\">上線使用者({{ onlineUsers.length || 0 }})</h1>\n        </div>\n        <div class=\"online-user-list\">\n          <div\n            v-for=\"onlineUser in onlineUsers\"\n            :key=\"onlineUser.id\"\n            class=\"user-panel\"\n          >\n            <!-- 上線使用者 -->\n            <div class=\"d-flex align-items-center connected-user p-2\">\n              <img\n                class=\"user-avatar mr-2\"\n                :src=\"onlineUser.avatar || 'https://i.imgur.com/S4PE66O.png'\"\n                alt=\"\"\n              />\n              <span>\n                <router-link class=\"link-style\" :to=\"'/users/' + onlineUser.id\">\n                  <strong class=\"mr-2\">{{ onlineUser.name }}</strong>\n                </router-link>\n                <span class=\"text-gray\">@{{ onlineUser.account }}</span>\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"col right-column no-gutters p-0\" id=\"main-panel\">\n        <div class=\"title-wrapper px-3 d-flex align-items-center\">\n          <h1 class=\"title\">公開聊天室</h1>\n          <label for=\"folding-online-user\"\n            ><i class=\"fas fa-list-ul\"></i\n          ></label>\n        </div>\n        <div @scroll=\"isToBelow\" class=\"message-board\" id=\"message-board\">\n          <div\n            class=\"message-box\"\n            v-for=\"message in messages\"\n            :key=\"message.id\"\n          >\n            <!-- 自己發的訊息 -->\n            <div\n              v-if=\"\n                message.stasus === undefined &&\n                message.UserId === currentUser.id\n              \"\n              class=\"my-message-wrapper d-flex justify-content-end px-3 py-1\"\n            >\n              <div class=\"message\">\n                <div class=\"d-flex justify-content-end\">\n                  <div class=\"message-text my-message-text py-2 px-3\">\n                    {{ message.message }}\n                  </div>\n                </div>\n                <div class=\"message-time text-right text-gray\">\n                  {{ new Date(message.time).toLocaleString() }}\n                </div>\n              </div>\n            </div>\n            <!-- 他人發的訊息 -->\n            <div\n              v-if=\"\n                message.stasus === undefined &&\n                message.UserId !== currentUser.id\n              \"\n              class=\"message-wrapper d-flex align-items-end px-3 py-2\"\n            >\n              <img\n                class=\"message-avatar mr-2\"\n                :src=\"message.avatar || 'https://i.imgur.com/S4PE66O.png'\"\n                alt=\"\"\n              />\n              <div class=\"message flex-grow-1\">\n                <div class=\"message-text bg-gray py-2 px-3\">\n                  {{ message.message }}\n                </div>\n                <div class=\"message-time text-gray\">\n                  {{ message.name }} said at\n                  {{ new Date(message.time).toLocaleString() }}\n                </div>\n              </div>\n            </div>\n            <!-- 使用者上下線訊息 -->\n            <div\n              v-if=\"\n                message.stasus === 'on' && message.userId !== currentUser.id\n              \"\n              class=\"user-status-wrapper d-flex justify-content-center py-2\"\n            >\n              <div\n                class=\"user-status badge badge-pill bg-gray font-weight-bold text-gray px-3\"\n              >\n                {{ message.userName }} 上線\n              </div>\n            </div>\n            <div\n              v-if=\"\n                message.stasus === 'off' && message.userId !== currentUser.id\n              \"\n              class=\"user-status-wrapper d-flex justify-content-center py-2\"\n            >\n              <div\n                class=\"user-status badge badge-pill bg-gray font-weight-bold text-gray px-3\"\n              >\n                {{ message.userName }} 下線\n              </div>\n            </div>\n          </div>\n          <button\n            v-show=\"!scrollToBottom\"\n            class=\"to-bot-btn btn\"\n            @click=\"scrollToBottom = true\"\n          >\n            <i class=\"fas fa-arrow-down\"></i>\n          </button>\n        </div>\n        <!-- 訊息輸入表單 -->\n        <form action=\"\" class=\"message-form\" @submit.stop.prevent>\n          <input\n            v-model=\"newMessage\"\n            type=\"text\"\n            name=\"message\"\n            class=\"message-input flex-grow-1 border-0 rounded-pill bg-gray form-control\"\n            placeholder=\"輸入訊息...\"\n            autocomplete=\"off\"\n          />\n          <button\n            @click=\"sendMessage\"\n            @keyup.enter=\"sendMessage\"\n            class=\"btn send-message-btn\"\n          >\n            <i class=\"fas fa-location-arrow\"></i>\n          </button>\n        </form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState } from \"vuex\"\nimport chatRoomAPI from \"./../apis/chatRoom\"\nimport { Toast } from \"./../utils/helpers\"\nimport { v4 as uuidv4 } from \"uuid\"\n\nexport default {\n  components: {},\n  data() {\n    return {\n      onlineUsers: [],\n      messages: [],\n      newMessage: '',\n      scrollModel: '',\n      scrollPosition: 0,\n      scrollToBottom: true\n    }\n  },\n  created() {\n    this.fetchPublicChatRoomHistory()\n  },\n  mounted() {\n    this.fetchOnlineUsers()\n    this.scrollModel = document.getElementById(\"message-board\")\n  },\n  updated() {\n    if (this.scrollToBottom === true) {\n      this.scrollModel.scrollTop = this.scrollModel.scrollHeight\n    }\n  },\n  destroyed() {\n    this.$store.commit(\"leavePublicChatRoom\")\n  },\n  computed: {\n    ...mapState([\"currentUser\", \"isInPublicChatRoom\"])\n  },\n  sockets: {\n    'init-public': function (onlineUsers) {\n      this.onlineUsers = onlineUsers\n    },\n    'public-message': function (message) {\n      message.id = uuidv4()\n      message.UserId = message.userId\n      this.messages.push(message)\n      this.$socket.emit('message-read-timestamp', { channelId: 0, time: Date.now() })\n    },\n    'user-on-off-line': function (userOnOff) {\n      if (userOnOff.id === this.currentUser.id) {\n        return\n      }\n\n      let userStasus = {\n        stasus: userOnOff.status,\n        userId: userOnOff.id,\n        id: uuidv4(),\n        userName: userOnOff.name\n      }\n      let nowOnlineUser = {\n        status: userOnOff.status,\n        account: userOnOff.account,\n        avatar: userOnOff.avatar,\n        id: userOnOff.id,\n        name: userOnOff.name\n      }\n      this.messages.push(userStasus)\n      if (nowOnlineUser.status === 'on') {\n        this.onlineUsers.push(nowOnlineUser)\n      }\n    }\n  },\n  methods: {\n    fetchOnlineUsers() {\n      this.$socket.emit('init-public', Date.now())\n    },\n    async fetchPublicChatRoomHistory() {\n      try {\n        const response = await chatRoomAPI.getPublicChatRoomHistory({ userId: this.currentUser.id })\n\n        if (response.status !== 200) {\n          throw new Error(response.statusText)\n        }\n\n        this.messages = response.data\n        this.$socket.emit('message-read-timestamp', { channelId: 0, time: Date.now() })\n        this.$store.commit(\"enterPublicChatRoom\")\n\n      } catch (error) {\n        console.log(error)\n        Toast.fire({\n          icon: \"error\",\n          title: \"無法取得上線使用者資訊，請稍後再試\",\n        })\n      }\n    },\n    async sendMessage() {\n      if (this.newMessage.trim().length === 0) { return }\n      await this.$socket.emit('public-message', {\n        account: this.currentUser.account,\n        avatar: this.currentUser.avatar,\n        UserId: this.currentUser.id,\n        name: this.currentUser.name,\n        message: this.newMessage,\n        time: Date.now()\n      })\n      this.newMessage = ''\n      this.scrollToBottom = true\n    },\n    isToBelow() {\n      this.scrollPosition = this.scrollModel.scrollTop + this.scrollModel.clientHeight\n      if (this.scrollPosition < this.scrollModel.scrollHeight) {\n        this.scrollToBottom = false\n      } else {\n        this.scrollToBottom = true\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\nlabel {\n  display: none;\n}\n.main-panel {\n  position: relative;\n}\n.message-input:focus {\n  background: #e6ecf0;\n  outline: none;\n  box-shadow: none;\n}\n.user-panel {\n  height: auto;\n}\n.message-time {\n  font-size: 14px;\n}\n.user-avatar {\n  height: 50px;\n  width: 50px;\n  border-radius: 25px;\n}\n.right-column {\n  border-right: 1px solid #e6ecf0;\n}\n.no-gutters {\n  padding-right: 0;\n  padding-left: 0;\n}\n.bg-gray {\n  background: #e6ecf0;\n}\n.text-gray {\n  color: #666;\n}\n.text-larger {\n  font-size: larger;\n}\n.center-column {\n  border-left: 1px solid #e6ecf0;\n  border-right: 1px solid #e6ecf0;\n  width: 300px;\n  height: 100vh;\n}\n.title-wrapper {\n  border-bottom: 1px solid #e6ecf0;\n  height: 55px;\n}\n.title {\n  color: #1c1c1c;\n  font-size: 18px;\n  font-weight: 700;\n  margin: 0;\n}\n.connected-user {\n  border-bottom: 1px solid #e6ecf0;\n}\n.link-style:hover {\n  text-decoration:underline;\n  color:#ff6600;\n}\n\n/* message-board */\n.row {\n  height: 100%;\n}\n.message-board {\n  height: calc(100vh - 55px - 61px);\n  overflow-y: auto;\n}\n.message-board .badge-pill {\n  font-size: 0.8rem;\n  font-weight: normal;\n  line-height: 20px;\n}\n.message-text {\n  border-radius: 1.5em 1.5em 1.5em 0;\n  max-width: 60%;\n  width: fit-content;\n  background: #eeeeee;\n  color: #333333;\n  word-break: break-word;\n}\n.message-avatar {\n  width: 40px;\n  height: 40px;\n  position: relative;\n  bottom: 4px;\n  border-radius: 20px;\n}\n.my-message-wrapper .message {\n  width: calc(100% - 40px - 16px);\n}\n.my-message-text {\n  border-radius: 1.5em 1.5em 0 1.5em;\n  background: #ff6600;\n  color: white;\n  position: relative;\n  right: 0;\n  max-width: 60%;\n}\n\n/* message-board: input */\n.message-form {\n  padding: 10px 10px;\n  border-top: 1px solid #e6ecf0;\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  display: flex;\n}\n.send-message-btn {\n  flex-basis: auto;\n}\n.fa-location-arrow {\n  transform: rotate(45deg);\n  font-size: 24px;\n  color: #ff6600;\n}\n/* 按鈕寬度class不行改，但id可以 */\n#btn-submit {\n  width: 100%;\n  height: 50px;\n}\n.btn-submit {\n  background: #ff6600;\n  border-radius: 50px;\n  width: 122px;\n  margin-top: 30px;\n  border: 1px solid transparent;\n  outline: none;\n  color: #ffffff;\n}\n.pages-link {\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 40px;\n}\n.link {\n  text-decoration: underline;\n}\n.sign-in-wrapper span {\n  color: #0099ff;\n}\na {\n  color: inherit;\n}\n.to-bot-btn {\n  font-size: 20px;\n  background: #eeeeee;\n  color: #666666;\n  line-height: 30px;\n  padding: 4px 10px;\n  position: absolute;\n  bottom: 74px;\n  right: 24px;\n}\n.chat-room-wrapper {\n  margin: 0 15px;\n}\n@media screen and (max-width: 992px) {\n  .online-user-box {\n    transform: scale(0, 1);\n    transition: transform 0.2s ease-in;\n    transform-origin: right;\n  }\n  .center-column {\n    height: calc(100vh - 55px - 61px);\n  }\n  .online-user-box {\n    position: absolute;\n    top: 55px;\n    right: 0;\n    z-index: 99;\n    background: white;\n    box-shadow: -10px 0px 10px -10px #666666;\n  }\n  #main-panel {\n    border-left: 1px solid #e6ecf0;\n  }\n  .online-user-title-wrapper {\n    justify-content: flex-end;\n  }\n  label {\n    font-size: 21px;\n    display: block;\n    margin: 0;\n    margin-left: 10px;\n    padding: 0 6px;\n  }\n  label:hover {\n    background: #ff6600;\n    border-radius: 6px;\n    cursor: pointer;\n  }\n  .folding-online-user:checked ~ .online-user-box {\n    transform: scale(1, 1);\n    transition: transform 0.2s ease-out;\n  }\n}\n@media screen and (max-width: 768px) {\n  .chat-room-wrapper {\n    margin: 0;\n  }\n}\n@media screen and (max-width: 576px) {\n  .message-input {\n    margin-left: 60px;\n  }\n}\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicChatroom.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicChatroom.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PublicChatroom.vue?vue&type=template&id=207c4454&scoped=true&\"\nimport script from \"./PublicChatroom.vue?vue&type=script&lang=js&\"\nexport * from \"./PublicChatroom.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PublicChatroom.vue?vue&type=style&index=0&id=207c4454&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"207c4454\",\n  null\n  \n)\n\nexport default component.exports","import { apiHelper } from './../utils/helpers'\nconst getToken = () => localStorage.getItem('token')\n\nexport default {\n  getPublicChatRoomHistory({ userId }) {\n    return apiHelper.post('/chat/messages', {\n      channelId: 0,\n      userId\n    }, {\n      headers: { Authorization: `Bearer ${getToken()}` }\n    })\n  },\n  getPublicChatRoomUnread({ userId }) {\n    return apiHelper.post('/chat/public_unread', {\n      userId\n    }, {\n      headers: { Authorization: `Bearer ${getToken()}` }\n    })\n  },\n  getAllPrivateChatRooms() {\n    return apiHelper.get('/chat/all_private_rooms', {\n      headers: { Authorization: `Bearer ${getToken()}` }\n    })\n  },\n  getPrivateChatRoomHistory({ channelId, userId }) {\n    return apiHelper.post('/chat/messages', {\n      channelId,\n      userId\n    }, {\n      headers: { Authorization: `Bearer ${getToken()}` }\n    })\n  },\n  getPrivateChatRoomUnread() {\n    return apiHelper.get('/chat/private_unread', {\n      headers: { Authorization: `Bearer ${getToken()}` }\n    })\n  },\n  getAllUsers() {\n    return apiHelper.get(`/users?accumulatedNum=all`, {\n      headers: { Authorization: `Bearer ${getToken()}` }\n    })\n  }\n}\n\n","var fails = require('../internals/fails');\nvar whitespaces = require('../internals/whitespaces');\n\nvar non = '\\u200B\\u0085\\u180E';\n\n// check that a method works with the correct list\n// of whitespaces and has a correct name\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    return !!whitespaces[METHOD_NAME]() || non[METHOD_NAME]() != non || whitespaces[METHOD_NAME].name !== METHOD_NAME;\n  });\n};\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;"],"sourceRoot":""}